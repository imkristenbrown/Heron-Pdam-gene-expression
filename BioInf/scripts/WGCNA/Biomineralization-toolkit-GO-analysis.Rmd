---
title: "Biomineralization Toolkit GP Enrichment Analysis"
author: "Kristen Brown, modified ZD"
date: "4/23/2024"
output:
  html_document: default
  pdf_document: default
---

# Biomineralization Toolkit GO EnrichmentAnalysis

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
sessionInfo() #provides list of loaded packages and version of R. 
```

First, load the necessary packages.

```{r load_libraries, include = TRUE}
# load libraries - notes show the install command needed to install (pre installed)
library(goseq)
library(dplyr)
library(forcats)
library(ggplot2)
library(gridExtra)
library(tidyr)
library(grDevices)
library(reshape2)
library(Rmisc)
library(ggpubr)
library(tibble)
library(gridExtra)
library(tidyr)
library(zoo)
library(ComplexHeatmap)
library(circlize)
library(GSEABase)
library(data.table)
library(stringr)
library(GenomicRanges)
library(rtracklayer)
library(rrvgo)
```

## Biomineralization toolkit present in modules

```{r}
biomin <- read.csv("../../output/Biomin_blast_Pocillopora_acuta_best_hit.csv") %>% rename("Pocillopora_acuta_best_hit" = "gene_id" )
```

```{r}
geneInfo <- read.csv("../../output/WGCNA/GO_analysis/geneInfo_WGCNA.csv")
```

```{r}
biomin_mod <- merge(biomin, geneInfo, by=c("gene_id"), all=F)
head(biomin_mod)
```

```{r}
length(unique(biomin_mod$gene_id))
```

```{r}
plyr::count(biomin_mod, "moduleColor")
```

## GO term enrichment for biomineralization genes (65 unique genes, but only 22 have GO term annotation)

```{r}
### Generate vector with names of all genes 
ALL.vector <- c(geneInfo$gene_id)
```

```{r}
### Generate length vector for all genes 
LENGTH.vector <- as.integer(geneInfo$Length)
```

```{r}
ID.vector_biomin <- biomin_mod %>%
  pull(gene_id) %>% unique()

##Get a list of GO Terms for the biomineralization genes
GO.terms_biomin <- biomin_mod %>%
  dplyr::select(gene_id, GOs) %>% unique() %>% rename(GOs = "GO.terms")

dim(GO.terms_biomin)
dim(GO.terms_biomin %>% filter(!is.na(GO.terms)))

## only 22/65 of these genes have GO annotations!!

##Get a list of GO Terms for the all 9012 genes
GO.terms <- geneInfo %>%
  dplyr::select(gene_id, GOs) %>% rename(GOs = "GO.terms")

dim(GO.terms)
dim(GO.terms %>% filter(!is.na(GO.terms)))
```

```{r}
##Format to have one goterm per row with gene ID repeated
split <- strsplit(as.character(GO.terms$GO.terms), ";") 
split2 <- data.frame(v1 = rep.int(GO.terms$gene, sapply(split, length)), v2 = unlist(split)) 
colnames(split2) <- c("gene_id", "GO.terms")
GO.terms<-split2
```

```{r}
##Construct list of genes with 1 for genes in module and 0 for genes not in the module
gene.vector = as.integer(ALL.vector %in% ID.vector_biomin) 
names(gene.vector)<-ALL.vector#set names
#weight gene vector by bias for length of gene 
pwf<-nullp(gene.vector, ID.vector, bias.data=LENGTH.vector) 
```

```{r}
#run goseq using Wallenius method for all categories of GO terms 
GO.wall<-goseq(pwf, ID.vector_biomin, gene2cat=GO.terms, test.cats=c("GO:BP", "GO:MF", "GO:CC"), method="Wallenius", use_genes_without_cat=TRUE)
GO <- GO.wall[order(GO.wall$over_represented_pvalue),]
colnames(GO)[1] <- "GOterm"
```

```{r}
head(GO)
```

```{r}
#Filtering for p < 0.05
GO_05 <- GO %>%
        dplyr::filter(over_represented_pvalue<0.05) %>%
        dplyr::arrange(., ontology, over_represented_pvalue)
   

#Write file of results 
write.csv(GO_05, file = "../../output/WGCNA/GO_analysis/goseq_pattern_biomin.csv")
```

```{r}
go_results <-read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_biomin.csv")
head(go_results)
```

```{r}
go_results_BP <- go_results %>%
      filter(ontology=="BP") %>%
      filter(over_represented_pvalue != "NA") %>%
      #filter(numInCat>10)%>%
      arrange(., over_represented_pvalue)

dim(go_results_BP)
head(go_results_BP)
```

Collapsing with simplifyEnrichment package

```{r, eval=FALSE}
library(simplifyEnrichment)
BP_terms <- go_results_BP$GOterm

Mat <- GO_similarity(BP_terms, ont = "BP", db = "org.Ce.eg.db")
pdf(file = "../../output/WGCNA/GO_analysis/biomin_GOSEM.pdf", width = 7, height = 5)
simplifyGO(Mat, word_cloud_grob_param = list(max_width = 50))
dev.off()
```

```{r}
library(rrvgo)
#Reduce/collapse GO term set with the rrvgo package 
simMatrix <- calculateSimMatrix(go_results_BP$GOterm,
                                orgdb="org.Ce.eg.db", #c. elegans database
                                ont="BP",
                                method="Rel")
```

```{r}
 #calculate similarity 
scores <- setNames(-log(go_results_BP$over_represented_pvalue), go_results_BP$GOterm)
reducedTerms <- reduceSimMatrix(simMatrix,
                                scores,
                                threshold=0.7,
                                orgdb="org.Ce.eg.db")
dim(reducedTerms)
```

```{r}
#keep only the goterms from the reduced list
go_results_BP_reduced <- go_results_BP %>% filter(GOterm %in% reducedTerms$go)

#add in parent terms to list of go terms 
go_results_BP_reduced$ParentTerm <- reducedTerms$parentTerm[match(go_results_BP_reduced$GOterm, reducedTerms$go)]

length(unique(go_results_BP_reduced$ParentTerm))
```

The reduced list of terms is 51 terms that falls under 15 parent terms.

```{r}
#write.csv(go_results_BP_reduced, "../../output/WGCNA/GO_analysis/Biomineralization_goterms.csv")
write.csv(go_results_BP_reduced, "../../output/WGCNA/GO_analysis/goseq_pattern_biomin_filtered.csv")
```

Can further reduce like so:

#### Further reduce by the following keywords
 
```{r}
#add vector for terms of interest to reduce number of GO terms - NOT using this to look at individual modules for exploratory purposes
keywords<-c("metabolism", "carbon","bicarbonate", "apoptosis", "death", "symbiosis", "regulation of cell communication", "trans membrane transport", "transmembrane",  "organic substance transport", "inorganic substance transport","response to stress", "antioxidant", "calcification","biomineralization", "heat","transporters","proton transport","ion transport","acid-base", "homeostasis")
```

Search for these keywords in the parent terms

```{r}
go_results_BP_reduced <- go_results_BP_reduced %>%
   filter(grepl(paste(keywords, collapse="|"), ParentTerm))
```

This is only 19 terms

```{r}
#write.csv(go_results_BP_reduced, "../../output/WGCNA/GO_analysis/Biomineralization_goterms.csv")
write.csv(go_results_BP_reduced, "../../output/WGCNA/GO_analysis/goseq_pattern_biomin_filtered_keywords.csv")
```

```{r}
#plot significantly enriched GO terms by Slim Category faceted by slim term 
 GO.plot_biomin <-  ggplot(go_results_BP_reduced, aes(x = ontology, y = term)) + 
    geom_point(aes(size=over_represented_pvalue)) + 
    scale_size(name="Over rep. p-value", trans="reverse", range=c(1,3))+
    facet_grid(ParentTerm ~ ., scales = "free", labeller = label_wrap_gen(width = 5, multi_line = TRUE))+
    theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"),
    strip.text.y = element_text(angle=0, size = 10),
    strip.text.x = element_text(size = 20),
    axis.text = element_text(size = 8),
    axis.title.x = element_blank(),
    axis.title.y = element_blank())
GO.plot_biomin


ggsave(filename="../../output/WGCNA/GO_analysis/GO.plot_biomin.pdf", plot=GO.plot_biomin, dpi=300, height=5, units="in", limitsize=FALSE)
```

## Combining with Calcification Up and Down module info to make figure 4

### Reduce the lists together
```{r}
# GO_05_up <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification.csv") %>% dplyr::select(-"X")
# GO_05_down <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification_down.csv") %>% dplyr::select(-"X")
# GO_05_biomin <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_biomin.csv") %>% dplyr::select(-"X")
```

```{r}
GO_05_up <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification_up_bymod.csv") %>% dplyr::select(-"X")
GO_05_down <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification_down_bymod.csv") %>% dplyr::select(-"X")
GO_05_biomin <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_biomin.csv") %>% dplyr::select(-"X")
```

```{r}
go_results_BP_up <- GO_05_up %>%
      filter(ontology=="BP")%>%
      filter(over_represented_pvalue != "NA") %>%
      #filter(numInCat>10)%>%
      arrange(., over_represented_pvalue)
dim(go_results_BP_up)

go_results_BP_down <- GO_05_down %>%
      filter(ontology=="BP")%>%
      filter(over_represented_pvalue != "NA") %>%
      #filter(numInCat>10)%>%
      arrange(., over_represented_pvalue)
dim(go_results_BP_down)

go_results_BP_biomin <- GO_05_biomin %>%
      filter(ontology=="BP")%>%
      filter(over_represented_pvalue != "NA") %>%
      #filter(numInCat>10)%>%
      arrange(., over_represented_pvalue)
dim(go_results_BP_biomin)


all_enriched_terms_up_down_biomin <- c(go_results_BP_up$GOterm,go_results_BP_down$GOterm,go_results_BP_biomin$GOterm)

length(all_enriched_terms_up_down_biomin)
length(unique(all_enriched_terms_up_down_biomin))
```

By reducing the lists together, we can ensure that each GO term is given the same parent term whether the term was in the Up or Down modules or the biomineralization genes.

```{r}
library(rrvgo)
#Reduce/collapse GO term set with the rrvgo package 
simMatrix <- calculateSimMatrix(unique(all_enriched_terms_up_down_biomin),
                                orgdb="org.Ce.eg.db", #c. elegans database
                                ont="BP",
                                method="Rel")
```

```{r}
#calculate similarity 
reducedTerms <- reduceSimMatrix(simMatrix,
                                scores = "size",
                                threshold=0.7,
                                orgdb="org.Ce.eg.db")
dim(reducedTerms)
```

```{r}
#keep only the goterms from the reduced list
go_results_BP_up_reduced <- go_results_BP_up %>%
  filter(GOterm %in% reducedTerms$go)

#add in parent terms to list of go terms 
go_results_BP_up_reduced$ParentTerm <- reducedTerms$parentTerm[match(go_results_BP_up_reduced$GOterm, reducedTerms$go)]

length(unique(go_results_BP_up_reduced$GOterm))
length(unique(go_results_BP_up_reduced$ParentTerm))

#keep only the goterms from the reduced list
go_results_BP_down_reduced <- go_results_BP_down %>%
  filter(GOterm %in% reducedTerms$go)
 #add in parent terms to list of go terms 
go_results_BP_down_reduced$ParentTerm <- reducedTerms$parentTerm[match(go_results_BP_down_reduced$GOterm, reducedTerms$go)]

length(unique(go_results_BP_down_reduced$GOterm))
length(unique(go_results_BP_down_reduced$ParentTerm))

#keep only the goterms from the reduced list
go_results_BP_biomin_reduced <- go_results_BP_biomin %>%
  filter(GOterm %in% reducedTerms$go)
 #add in parent terms to list of go terms 
go_results_BP_biomin_reduced$ParentTerm <- reducedTerms$parentTerm[match(go_results_BP_biomin_reduced$GOterm, reducedTerms$go)]

length(unique(go_results_BP_biomin_reduced$GOterm))
length(unique(go_results_BP_biomin_reduced$ParentTerm))
```

#### Further reduce by the following keywords
 
```{r}
#add vector for terms of interest to reduce number of GO terms - NOT using this to look at individual modules for exploratory purposes
keywords<-c("metabolism", "carbon","bicarbonate", "apoptosis", "death", "symbiosis", "regulation of cell communication", "trans membrane transport", "transmembrane",  "organic substance transport", "inorganic substance transport","response to stress", "antioxidant", "calcification","biomineralization", "heat","transporters","proton transport","ion transport","acid-base", "homeostasis")
```

Search for these keywords in the parent terms

```{r}
go_results_BP_up_reduced_keywords <- go_results_BP_up_reduced %>%
   filter(grepl(paste(keywords, collapse="|"), ParentTerm))

length(unique(go_results_BP_up_reduced_keywords$GOterm))
length(unique(go_results_BP_up_reduced_keywords$ParentTerm))

go_results_BP_down_reduced_keywords <- go_results_BP_down_reduced %>%
   filter(grepl(paste(keywords, collapse="|"), ParentTerm))

length(unique(go_results_BP_down_reduced_keywords$GOterm))
length(unique(go_results_BP_down_reduced_keywords$ParentTerm))

go_results_BP_biomin_reduced_keywords <- go_results_BP_biomin_reduced %>%
   filter(grepl(paste(keywords, collapse="|"), ParentTerm))

length(unique(go_results_BP_biomin_reduced_keywords$GOterm))
length(unique(go_results_BP_biomin_reduced_keywords$ParentTerm))
```


```{r}
#write.csv(go_results_BP_up_reduced_keywords, "../../output/WGCNA/GO_analysis/goseq_pattern_calcification_filtered.csv")
#write.csv(go_results_BP_down_reduced_keywords, "../../output/WGCNA/GO_analysis/goseq_pattern_calcification_down_filtered.csv")
#write.csv(go_results_BP_biomin_reduced_keywords, "../../output/WGCNA/GO_analysis/goseq_pattern_biomin_filtered.csv")
```

Won't move forward with these for now, but they are there if we need further reduced lists.

### Combining lists with factor

The following list is a list of BP-ontology ("Biological Process") GO terms that were significantly enriched (P < 0.05) within the modules that were upregulated for calcification. The list has been further reduced by using the package rrvgo.

```{r}
#cal_up_terms <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification_filtered.csv")
cal_up_terms <- go_results_BP_up_reduced

cal_up_terms <- cal_up_terms %>%
  mutate(Factor = "Up")

cal_up_terms_parent_nterm <- cal_up_terms %>%
  dplyr::group_by(ParentTerm) %>%
  dplyr::summarize(Number.of.terms = n_distinct(term)) %>%
  mutate(Calcification.direction = "Up")  %>% ungroup()

head(cal_up_terms)
```

The following list is a list of BP-ontology ("Biological Process") GO terms that were significantly enriched (P < 0.05) within the modules that were downregulated for calcification. The list has been further reduced by using the package rrvgo.

```{r}
#cal_down_terms <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_calcification_down_filtered.csv")
cal_down_terms <- go_results_BP_down_reduced
cal_down_terms <- cal_down_terms %>% mutate(Factor = "Down")

cal_down_terms_parent_nterm <- cal_down_terms %>%
  dplyr::group_by(ParentTerm) %>%
  dplyr::summarize(Number.of.terms = n_distinct(term)) %>%
  mutate(Calcification.direction = "Down")  %>% ungroup()

head(cal_down_terms)
```

The following list is a list of BP-ontology ("Biological Process") GO terms that were significantly enriched (P < 0.05) within the list of biomineralization-related genes. The list has been further reduced by using the package rrvgo.

```{r}
#cal_biomin_terms <- read.csv("../../output/WGCNA/GO_analysis/goseq_pattern_biomin_filtered.csv")
cal_biomin_terms <- go_results_BP_biomin_reduced
cal_biomin_terms <- cal_biomin_terms %>% mutate(Factor = "Biomin") %>% mutate(Module = "Biomin")
head(cal_biomin_terms)
```

### Merge up and down-regulation of calcification GOterms along with GOterms enriched in the biomineralization gene list

The following list is a list of BP-ontology ("Biological Process") GO terms that were significantly enriched (P < 0.05) within the modules that were upregulated *or* downregulated for calcification *or* in the biomineralization gene list. The list has been further reduced by using the package rrvgo.

```{r}
all_terms <- rbind(cal_down_terms,cal_up_terms,cal_biomin_terms)

all_terms <-  all_terms[,c("Factor","GOterm","over_represented_pvalue","under_represented_pvalue","numDEInCat","numInCat","term","ontology","ParentTerm","Module")]

all_terms$GOterm<-as.factor(all_terms$GOterm)

dim(all_terms) #785 reduced terms 

length(unique(all_terms$GOterm)) #this represents 780 unique terms between the three lists of reduced terms
length(unique(all_terms$ParentTerm)) #this represents 92 unique terms between the three lists of reduced terms
```

### Unique terms

This is collapsing the list from 2287 rows to 2036, representing the 2036 unique GO terms in the list above. It collapses the information in the columns "ParentTerm" and "Factor" so that for each GO term we get the parent terms associated and if this was enriched in modules upregulated for calcification, downregulated for calcification, or both.

```{r}
goterms_shared <- all_terms %>%
  group_by(GOterm) %>%
  dplyr::summarise(
    ParentTerm = paste(unique(ParentTerm), collapse = ", "),
    Factor = paste(unique(Factor), collapse = ", "),
    term = paste(unique(term), collapse = ", ")
  )
dim(goterms_shared)

goterms_shared_full <- goterms_shared %>%
  left_join(dplyr::select(all_terms,GOterm, Factor, over_represented_pvalue), by = "GOterm") %>% #select 3 columns GOterm, Factor, over_represented_pvalue from all_terms and left join by GOterm, turns this dataframe from 1817 rows back to the 3453 in all_terms
  mutate(pvalue_Up = ifelse(Factor.y == "Up", over_represented_pvalue, NA)) %>% #add a column that is the p-value for the Up factor
  mutate(pvalue_Down = ifelse(Factor.y == "Down", over_represented_pvalue, NA)) %>% #add a column that is the p-value for the Down factor
  mutate(pvalue_Biomin = ifelse(Factor.y == "Biomin", over_represented_pvalue, NA)) %>% #add a column that is the p-value for the Biomin factor
  dplyr::select(-c("over_represented_pvalue", "Factor.y")) %>% #remove the unique columns so that we can collapse the dataframe
  group_by(GOterm, ParentTerm, Factor.x, term) %>% #group by the repeated columns for the non-unique GO terms
  dplyr::summarize(pvalue_Up = na.omit(pvalue_Up)[1], #carry over the p-value for the term in the up direction, by taking the first non-NA value.
            pvalue_Down = na.omit(pvalue_Down)[1], #carry over the p-value for the term in the down direction, by taking the first non-NA value.
            pvalue_Biomin = na.omit(pvalue_Biomin)[1]) %>% #carry over the p-value for the term in the biomin list, by taking the first non-NA value.
  rename(Factor.x = "Factor") #rename column 
```

```{r}
write.csv(goterms_shared_full, "../../output/WGCNA/GO_analysis/Merged_GOterms_factor_ParentTerm_with_Biomin.csv")
```

```{r}
goterms_shared_full <- read.csv("../../output/WGCNA/GO_analysis/Merged_GOterms_factor_ParentTerm_with_Biomin.csv")
```

### calculations to check before plots

```{r}
goterms_shared_full <- goterms_shared_full %>% group_by(ParentTerm) %>% mutate("N_in_Parent" = n()) %>% ungroup()

goterms_up <- goterms_shared_full %>% dplyr::filter(Factor=="Up")
goterms_down <- goterms_shared_full %>% dplyr::filter(Factor=="Down")
goterms_biomin <- goterms_shared_full %>% dplyr::filter(Factor=="Biomin")
goterms_shared_only <- goterms_shared_full %>% dplyr::filter(Factor=="Down, Up")
goterms_shared_only_biomin <- goterms_shared_full %>% dplyr::filter(Factor=="Down, Up, Biomin" | Factor=="Up, Biomin" | Factor=="Down, Biomin")

nrow(goterms_up)
nrow(goterms_down)
nrow(goterms_biomin)
nrow(goterms_shared_only)
nrow(goterms_shared_only_biomin)

nrow(goterms_up) + nrow(goterms_down) + nrow(goterms_biomin) + nrow(goterms_shared_only) + nrow(goterms_shared_only_biomin) == nrow(goterms_shared_full)

#how many parent terms in each
length(unique(goterms_up$ParentTerm))
length(unique(goterms_down$ParentTerm))
length(unique(goterms_biomin$ParentTerm))
length(unique(goterms_shared_only$ParentTerm))
length(unique(goterms_shared_only_biomin$ParentTerm))
```

## Plot of parent terms SHARED by Up and Down modules

### For each parent term in this list, how many are "Up" by calcification and "Down" by calcification, whether or not they are also enriched in the biomineralization gene list

SharedGOterms = # of GO terms within the parent term that are in the list for each of the different factors

```{r}
result_parent_unique <- goterms_shared_full %>%
  group_by(ParentTerm,Factor) %>%
  dplyr::summarise(SharedGOterms = n_distinct(GOterm)) %>%
  arrange(-SharedGOterms)

unique(result_parent_unique$Factor)
```

For SHARED parent terms (ones that are in Up AND Down, whether or not they are in Biomin)

```{r}
parents_shared <- result_parent_unique %>%
  dplyr::filter(Factor == "Down, Up, Biomin" | Factor=="Down, Up")
 #dplyr::filter(SharedGOterms>=5) 
```

### Calculate the percentage of shared GOterms with Biomin. for upregulation of calcification
```{r}
merged_shared <- parents_shared %>%
  dplyr::group_by(ParentTerm) %>%
  mutate(
    Has_Biomin = any(Factor == "Down, Up, Biomin"),
    Sum_of_SharedGOterms = sum(SharedGOterms, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = ifelse(
      Factor %in% c("Down, Up, Biomin"),
      SharedGOterms / Sum_of_SharedGOterms,
      0
    )
  ) %>%
  mutate(Percentage.of.shared.GO.terms.with.biomineralization.genes = Proportion.of.shared.GO.terms.with.biomineralization.genes * 100) %>%
  filter((Has_Biomin == TRUE & Factor == "Down, Up, Biomin") | (Has_Biomin == FALSE & Factor == "Down, Up"))

merged_shared_clean <- na.omit(merged_shared) #remove rows for the non-"Down, Up, Biomin" rows that don't have a percentage
head(merged_shared_clean)
```

### Frequency >0 

```{r}
cal_freq_terms_filtered_shared <- merged_shared_clean %>%
  filter(Sum_of_SharedGOterms>=0) 
head(cal_freq_terms_filtered_shared)
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_shared, aes(y=Sum_of_SharedGOterms,x=reorder(ParentTerm, Sum_of_SharedGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_SharedGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,30))+
  scale_fill_gradientn(colours=c("white","#E6E6FA","#C9A0DC","#9370DB","#663399"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_colored_sharedUpDown.pdf", plot=freq_fig_up, dpi=300, height=15, width=10, units="in", limitsize=FALSE)
```


### Frequency >20 

```{r}
cal_freq_terms_filtered_shared <- merged_shared_clean %>%
  filter(Sum_of_SharedGOterms>=20) 
head(cal_freq_terms_filtered_shared)
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_shared, aes(y=Sum_of_SharedGOterms,x=reorder(ParentTerm, Sum_of_SharedGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_SharedGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,60))+
  scale_fill_gradientn(colours=c("white","#E6E6FA","#C9A0DC","#9370DB","#663399"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_colored_sharedUpDown_gr20.pdf", plot=freq_fig_up, dpi=300, height=7, width=10, units="in", limitsize=FALSE)
```
### Percentage shared >20 

```{r}
cal_freq_terms_filtered_shared <- merged_shared_clean %>%
  filter(Percentage.of.shared.GO.terms.with.biomineralization.genes>80) 
head(cal_freq_terms_filtered_shared)
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_shared, aes(y=Sum_of_SharedGOterms,x=reorder(ParentTerm, Percentage.of.shared.GO.terms.with.biomineralization.genes), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_SharedGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,60))+
  scale_fill_gradientn(colours=c("white","#E6E6FA","#C9A0DC","#9370DB","#663399"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_colored_sharedUpDown_80percentshared.pdf", plot=freq_fig_up, dpi=300, height=10, width=10, units="in", limitsize=FALSE)
```

```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_shared, aes(y=Sum_of_SharedGOterms,x=reorder(ParentTerm, Sum_of_SharedGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_SharedGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,60))+
  scale_fill_gradientn(colours=c("white","#E6E6FA","#C9A0DC","#9370DB","#663399"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_colored_sharedUpDown_80percentsharedordered.pdf", plot=freq_fig_up, dpi=300, height=10, width=10, units="in", limitsize=FALSE)
```

## Plot of parent terms UNIQUE for Up and Down modules

For UNIQUE parent terms (ones that are only in Up or only in Down, whether or not they are in Biomin)

For UNIQUE parent terms (ones that are only in Up or only in Down, whether or not they are in Biomin)


```{r}
parent_filtered_up <- result_parent_unique %>%
 dplyr::filter(Factor == "Up" | Factor=="Up, Biomin")
#dplyr::filter(SharedGOterms>=5)

# parent_filtered_up <- result_parent_unique %>%
#   dplyr::filter(Factor=="Up, Biomin")
#  #dplyr::filter(SharedGOterms>=5) 
```

```{r}
parent_filtered_down <- result_parent_unique %>%
 dplyr::filter(Factor=="Down" | Factor=="Down, Biomin")
#dplyr::filter(SharedGOterms>=5)

# parent_filtered_down <- result_parent_unique %>%
#   dplyr::filter(Factor=="Down, Biomin")
#  #dplyr::filter(SharedGOterms>=5) 
```


### Calculate the percentage of unique UP GO parent terms with Biomin. for upregulation of calcification
```{r}
merged_up <- parent_filtered_up %>%
  dplyr::group_by(ParentTerm) %>%
  left_join(cal_up_terms_parent_nterm, by = "ParentTerm") %>%
  rename(SharedGOterms = "UniqueGOTerms") %>%
  mutate(
    Has_Biomin = any(Factor == "Up, Biomin"),
    Sum_of_UniqueGOterms = sum(UniqueGOTerms, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = ifelse(
      Factor %in% c("Up, Biomin"),
      UniqueGOTerms / Sum_of_UniqueGOterms,
      0
    )
  ) %>%
  mutate(Percentage.of.shared.GO.terms.with.biomineralization.genes = Proportion.of.shared.GO.terms.with.biomineralization.genes * 100) %>%
  filter((Has_Biomin == TRUE & Factor == "Up, Biomin") | (Has_Biomin == FALSE & Factor == "Up"))

merged_up_clean <- na.omit(merged_up) #remove rows for the non-"Up, Biomin" rows that don't have a percentage
merged_up_clean
```

### Calculate the percentage of shared GOterms downregulation of calcification
```{r}
merged_down <- parent_filtered_down %>%
  dplyr::group_by(ParentTerm) %>%
  left_join(cal_down_terms_parent_nterm, by = "ParentTerm") %>%
  rename(SharedGOterms = "UniqueGOTerms") %>%
  mutate(
    Has_Biomin = any(Factor == "Down, Biomin"),
    Sum_of_UniqueGOterms = sum(UniqueGOTerms, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = ifelse(
      Factor %in% c("Down, Biomin"),
      UniqueGOTerms / Sum_of_UniqueGOterms,
      0
    )
  ) %>%
  mutate(Percentage.of.shared.GO.terms.with.biomineralization.genes = Proportion.of.shared.GO.terms.with.biomineralization.genes * 100) %>%
  filter((Has_Biomin == TRUE & Factor == "Down, Biomin") | (Has_Biomin == FALSE & Factor == "Down"))

merged_down_clean <- na.omit(merged_down) #remove rows for the non-"Down, Biomin" rows that don't have a percentage
merged_down_clean
```

### Frequency all up

```{r}
cal_freq_terms_filtered_up <- merged_up_clean %>%
  #filter(Number.of.terms>=10) %>%
  filter(Calcification.direction=="Up")
cal_freq_terms_filtered_up
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_up, aes(y=Sum_of_UniqueGOterms,x=reorder(ParentTerm, Sum_of_UniqueGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_UniqueGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,15))+
  scale_fill_gradientn(colours=c("white","#fddbc7","#f4a582","#d6604d","#b2182b"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12)) #making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_up_colored_unique.pdf", plot=freq_fig_up, dpi=300, height=15, width=10, units="in", limitsize=FALSE)
```

### Frequency all down

```{r}
cal_freq_terms_filtered_down <- merged_down_clean %>%
  #filter(Number.of.terms>=10) %>%
  filter(Calcification.direction=="Down")
cal_freq_terms_filtered_down
```

#### Figure

```{r}
freq_fig_down<-ggplot(cal_freq_terms_filtered_down, aes(y=Sum_of_UniqueGOterms,x=reorder(ParentTerm, Sum_of_UniqueGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_UniqueGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,20))+
  scale_fill_gradientn(colours=c("white","#d1e5f0","#92c5de","#4393c3","#2166ac"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_down

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_down_colored_unique.pdf", plot=freq_fig_down, dpi=300, height=15, width=10, units="in", limitsize=FALSE)
```

```{r}
compare_figs<-cowplot::plot_grid(freq_fig_up, freq_fig_down, nrow=2, align="v")
compare_figs
```

### Percentage up >0 

```{r}
cal_freq_terms_filtered_up <- merged_up_clean %>%
  filter(Percentage.of.shared.GO.terms.with.biomineralization.genes>0) %>%
  filter(Calcification.direction=="Up")
cal_freq_terms_filtered_up
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_up, aes(y=Sum_of_UniqueGOterms,x=reorder(ParentTerm, Sum_of_UniqueGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_UniqueGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,15))+
  scale_fill_gradientn(colours=c("white","#fddbc7","#f4a582","#d6604d","#b2182b"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12)) #making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_up_colored_unique_biomin_only.pdf", plot=freq_fig_up, dpi=300, height=5, width=10, units="in", limitsize=FALSE)
```

### Frequency >0 down

```{r}
cal_freq_terms_filtered_down <- merged_down_clean %>%
  filter(Percentage.of.shared.GO.terms.with.biomineralization.genes>0) %>%
  filter(Calcification.direction=="Down")
cal_freq_terms_filtered_down
```

#### Figure

```{r}
freq_fig_down<-ggplot(cal_freq_terms_filtered_down, aes(y=Sum_of_UniqueGOterms,x=reorder(ParentTerm, Sum_of_UniqueGOterms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Sum_of_UniqueGOterms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,20))+
  scale_fill_gradientn(colours=c("white","#d1e5f0","#92c5de","#4393c3","#2166ac"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_down

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_down_colored_unique_biomin_only.pdf", plot=freq_fig_down, dpi=300, height=5, width=10, units="in", limitsize=FALSE)
```

```{r}
compare_figs<-cowplot::plot_grid(freq_fig_up, freq_fig_down, nrow=2, align="v")
compare_figs
```

## Plot of parent terms SHARED _and_ UNIQUE for Up and Down modules

For SHARED _and_ UNIQUE parent terms 

```{r}
# parent_filtered_up <- result_parent_unique %>%
#   dplyr::filter(Factor=="Up, Biomin" | Factor == "Down, Up, Biomin")
#  #dplyr::filter(SharedGOterms>=5) 

parent_filtered_up <- result_parent_unique %>%
  dplyr::filter(Factor == "Up" | Factor=="Up, Biomin" | Factor == "Down, Up, Biomin" | Factor=="Down, Up")
 #dplyr::filter(SharedGOterms>=5) 
```

```{r}
# parent_filtered_down <- result_parent_unique %>%
#   dplyr::filter(Factor=="Down, Biomin" | Factor == "Down, Up, Biomin")
#  #dplyr::filter(SharedGOterms>=5) 

parent_filtered_down <- result_parent_unique %>%
  dplyr::filter(Factor == "Down" | Factor=="Down, Biomin" | Factor == "Down, Up, Biomin" | Factor=="Down, Up")
 #dplyr::filter(SharedGOterms>=5) 
```

### Calculate the percentage of UP GO parent terms with Biomin. for upregulation of calcification
```{r}
merged_up <- parent_filtered_up %>%
  dplyr::group_by(ParentTerm) %>%
  left_join(cal_up_terms_parent_nterm, by = "ParentTerm") %>%
  rename(SharedGOterms = "UpGOTerms") %>%
  mutate(
    Has_Biomin = any(Factor %in% c("Up, Biomin", "Down, Up, Biomin")),
    Sum_of_UpGOterms = sum(UpGOTerms, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = case_when(
      Factor %in% c("Up, Biomin", "Down, Up, Biomin") ~ UpGOTerms / Sum_of_UpGOterms,
      TRUE ~ 0
    )
  ) %>%
  mutate(Percentage.of.shared.GO.terms.with.biomineralization.genes = Proportion.of.shared.GO.terms.with.biomineralization.genes * 100) %>%
  filter((Has_Biomin == TRUE & Factor == "Up, Biomin") | (Has_Biomin == TRUE & Factor == "Down, Up, Biomin") | (Has_Biomin == FALSE & Factor == "Up") | (Has_Biomin == FALSE & Factor == "Down, Up")) %>% 
  dplyr::group_by(ParentTerm) %>% 
  mutate(
    UpGOTerms = sum(UpGOTerms, na.rm = TRUE),
    Percentage.of.shared.GO.terms.with.biomineralization.genes = sum(Percentage.of.shared.GO.terms.with.biomineralization.genes, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = sum(Proportion.of.shared.GO.terms.with.biomineralization.genes, na.rm = TRUE)
  ) %>%
  filter(row_number() == 1)

merged_up_clean <- na.omit(merged_up) #remove rows for the non-"Up, Biomin" rows that don't have a percentage
merged_up_clean
```

### Calculate the percentage of Down GO parent terms with Biomin. for upregulation of calcification
```{r}
merged_down <- parent_filtered_down %>%
  dplyr::group_by(ParentTerm) %>%
  left_join(cal_down_terms_parent_nterm, by = "ParentTerm") %>%
  rename(SharedGOterms = "DownGOTerms") %>%
  mutate(
    Has_Biomin = any(Factor %in% c("Down, Biomin", "Down, Up, Biomin")),
    Sum_of_DownGOterms = sum(DownGOTerms, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = case_when(
      Factor %in% c("Down, Biomin", "Down, Up, Biomin") ~ DownGOTerms / Sum_of_DownGOterms,
      TRUE ~ 0
    )
  ) %>%
  mutate(Percentage.of.shared.GO.terms.with.biomineralization.genes = Proportion.of.shared.GO.terms.with.biomineralization.genes * 100) %>%
  filter((Has_Biomin == TRUE & Factor == "Down, Biomin") | (Has_Biomin == TRUE & Factor == "Down, Up, Biomin") | (Has_Biomin == FALSE & Factor == "Down") | (Has_Biomin == FALSE & Factor == "Down, Up")) %>% 
  dplyr::group_by(ParentTerm) %>% 
  mutate(
    DownGOTerms = sum(DownGOTerms, na.rm = TRUE),
    Percentage.of.shared.GO.terms.with.biomineralization.genes = sum(Percentage.of.shared.GO.terms.with.biomineralization.genes, na.rm = TRUE),
    Proportion.of.shared.GO.terms.with.biomineralization.genes = sum(Proportion.of.shared.GO.terms.with.biomineralization.genes, na.rm = TRUE)
  ) %>%
  filter(row_number() == 1)

merged_down_clean <- na.omit(merged_down) #remove rows for the non-"Down, Biomin" rows that don't have a percentage
merged_down_clean
```

### Frequency up

```{r}
cal_freq_terms_filtered_up <- merged_up_clean %>%
  #filter(Number.of.terms>=20) %>%
  filter(Calcification.direction=="Up")
cal_freq_terms_filtered_up
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_up, aes(y=Number.of.terms,x=reorder(ParentTerm, Number.of.terms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Number.of.terms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,15))+
  scale_fill_gradientn(colours=c("white","#fddbc7","#f4a582","#d6604d","#b2182b"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12)) #making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_up_colored_all.pdf", plot=freq_fig_up, dpi=300, height=25, width=10, units="in", limitsize=FALSE)
```

### Frequency down

```{r}
cal_freq_terms_filtered_down <- merged_down_clean %>%
  #filter(Number.of.terms>=20) %>%
  filter(Calcification.direction=="Down")
cal_freq_terms_filtered_down
```

#### Figure

```{r}
freq_fig_down<-ggplot(cal_freq_terms_filtered_down, aes(y=Number.of.terms,x=reorder(ParentTerm, Number.of.terms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Number.of.terms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,20))+
  scale_fill_gradientn(colours=c("white","#d1e5f0","#92c5de","#4393c3","#2166ac"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_down

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_down_colored_all.pdf", plot=freq_fig_down, dpi=300, height=25, width=10, units="in", limitsize=FALSE)
```

### Frequency >10 up

```{r}
cal_freq_terms_filtered_up <- merged_up_clean %>%
  filter(Number.of.terms>=10) %>%
  filter(Calcification.direction=="Up")
cal_freq_terms_filtered_up
```

#### Figure
```{r}
freq_fig_up<-ggplot(cal_freq_terms_filtered_up, aes(y=Number.of.terms,x=reorder(ParentTerm, Number.of.terms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Number.of.terms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,15))+
  scale_fill_gradientn(colours=c("white","#fddbc7","#f4a582","#d6604d","#b2182b"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12)) #making the axis title larger 
freq_fig_up

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_up_colored_all_gr10.pdf", plot=freq_fig_up, dpi=300, height=10, width=10, units="in", limitsize=FALSE)
```

### Frequency >10 down

```{r}
cal_freq_terms_filtered_down <- merged_down_clean %>%
  filter(Number.of.terms>=10) %>%
  filter(Calcification.direction=="Down")
cal_freq_terms_filtered_down
```

#### Figure

```{r}
freq_fig_down<-ggplot(cal_freq_terms_filtered_down, aes(y=Number.of.terms,x=reorder(ParentTerm, Number.of.terms), fill=Percentage.of.shared.GO.terms.with.biomineralization.genes,group=1))+
  geom_point(size=5, alpha=1, pch=21,color="black")+
  geom_segment(aes(x=ParentTerm, xend=ParentTerm, y=0, yend=Number.of.terms)) +
  geom_hline(yintercept = 0, linetype="solid", color = 'black', size=0.5, show.legend = TRUE)+
  coord_flip()+
  #scale_y_continuous(expression(GO~term~counts),limits=c(0,20))+
  scale_fill_gradientn(colours=c("white","#d1e5f0","#92c5de","#4393c3","#2166ac"), na.value = "grey98",limits = c(0, 100))+ 
  theme_classic()+
  theme(axis.text.x=element_text(vjust=0.5, hjust=0.95,size=12),
        plot.title = element_text(margin = margin(t = 10, b = 10), hjust=0.5),
        panel.background= element_rect(fill=NA, color='black'),
        legend.title = element_blank(),
        axis.text.y = element_text(vjust=0.5, size=12), #making the axis text larger 
        axis.title.x = element_blank(),#making the axis title larger 
        axis.title.y = element_blank(),
        strip.text = element_text(size=12))#making the axis title larger 
freq_fig_down

ggsave(filename="../../output/WGCNA/GO_analysis/freq_fig_down_colored_all_gr10.pdf", plot=freq_fig_down, dpi=300, height=10, width=10, units="in", limitsize=FALSE)
```

